# ë²•ì œì²˜ OpenAPI í¬ë¡¤ë§ ë°ì´í„° ë¶„ì„ ë° í†µí•© ë°©ì•ˆ

## ğŸ“Š 1. í¬ë¡¤ë§ ì½”ë“œ ê°œì„  ì‚¬í•­

### **ì›ë³¸ ì½”ë“œ ë¬¸ì œì **
```python
keywords = ["ì°¨ëŸ‰", "êµí†µì‚¬ê³ "]  # âŒ í‚¤ì›Œë“œ ë¶€ì¡±
FETCH_DETAILS = True
MAX_PAGES = 10  # âŒ ì œí•œì 
```

### **ê°œì„ ëœ ì½”ë“œ** ([scripts/crawl_legal_cases.py](scripts/crawl_legal_cases.py))

#### **1.1 í™•ì¥ëœ í‚¤ì›Œë“œ ëª©ë¡ (40ê°œ+)**
```python
TRAFFIC_KEYWORDS = [
    # ê¸°ë³¸ í‚¤ì›Œë“œ
    "êµí†µì‚¬ê³ ", "ë„ë¡œêµí†µë²•", "ì°¨ëŸ‰", "ìë™ì°¨",

    # ìœ„ë°˜ í–‰ìœ„ (15ê°œ)
    "ìŒì£¼ìš´ì „", "ë¬´ë©´í—ˆìš´ì „", "ì‹ í˜¸ìœ„ë°˜", "ì†ë„ìœ„ë°˜", "ê³¼ì†",
    "ì¤‘ì•™ì„ ì¹¨ë²”", "ì°¨ì„ ìœ„ë°˜", "ë¼ì–´ë“¤ê¸°", "ë‚œí­ìš´ì „", "ë³´ë³µìš´ì „",
    "ëº‘ì†Œë‹ˆ", "ë„ì£¼", "ì‚¬ê³ í›„ë„ì£¼", "êµ¬í˜¸ì¡°ì¹˜ë¶ˆì´í–‰", "ìŒì£¼ì¸¡ì •ê±°ë¶€",

    # ë²•ê·œ (3ê°œ)
    "êµí†µì‚¬ê³ ì²˜ë¦¬íŠ¹ë¡€ë²•", "íŠ¹ì •ë²”ì£„ê°€ì¤‘ì²˜ë²Œë“±ì—ê´€í•œë²•ë¥ ", "êµí†µë²•ê·œ",

    # ìš´ì „/ì°¨ëŸ‰ (7ê°œ)
    "ìš´ì „", "ìš´ì „ë©´í—ˆ", "ë©´í—ˆì·¨ì†Œ", "ë©´í—ˆì •ì§€", "ì°¨ëŸ‰ìš´í–‰",
    "ì •ì°¨", "ì£¼ì°¨", "ì£¼ì •ì°¨ìœ„ë°˜",

    # ì‚¬ê³  ìœ í˜• (6ê°œ)
    "ì¶”ëŒì‚¬ê³ ", "ì ‘ì´‰ì‚¬ê³ ", "ì „ë³µì‚¬ê³ ", "ì¸ëª…ì‚¬ê³ ",
    "ë³´í–‰ì", "íš¡ë‹¨ë³´ë„", "ì¸ë„", "ìì „ê±°ë„ë¡œ",

    # ê¸°íƒ€ (5ê°œ)
    "ë„ë¡œ", "ê³ ì†ë„ë¡œ", "ìë™ì°¨ì „ìš©ë„ë¡œ",
    "ì´ë¥œì°¨", "ì˜¤í† ë°”ì´", "ìì „ê±°", "ì „ë™í‚¥ë³´ë“œ"
]

# ê°•í•œ í‚¤ì›Œë“œ (ë†’ì€ ì—°ê´€ì„±)
STRONG_KEYWORDS = [
    "êµí†µì‚¬ê³ ", "ë„ë¡œêµí†µë²•", "ìŒì£¼ìš´ì „", "ëº‘ì†Œë‹ˆ",
    "êµí†µì‚¬ê³ ì²˜ë¦¬íŠ¹ë¡€ë²•", "ë¬´ë©´í—ˆìš´ì „", "ì‹ í˜¸ìœ„ë°˜"
]
```

#### **1.2 ì—°ê´€ì„± íŒë‹¨ ë¡œì§ ì¶”ê°€**
```python
def is_traffic_related(case_data: Dict, threshold: int = 1) -> bool:
    """
    íŒë¡€ê°€ êµí†µì‚¬ê³ /ë„ë¡œêµí†µë²•ê³¼ ì—°ê´€ë˜ì–´ ìˆëŠ”ì§€ íŒë‹¨

    íŒë‹¨ ê¸°ì¤€:
    1. ê°•í•œ í‚¤ì›Œë“œ 1ê°œ ì´ìƒ â†’ ì¦‰ì‹œ ì—°ê´€ ìˆìŒ
    2. ì¼ë°˜ í‚¤ì›Œë“œ threshold ê°œ ì´ìƒ â†’ ì—°ê´€ ìˆìŒ
    3. ì‚¬ê±´ë²ˆí˜¸, ë²•ì›ëª…, íŒì‹œì‚¬í•­, íŒê²°ìš”ì§€ ë“± ì¢…í•© ê²€ìƒ‰
    """
    # ê²€ìƒ‰ í•„ë“œ: ì‚¬ê±´ë²ˆí˜¸, ë²•ì›ëª…, íŒì‹œì‚¬í•­, íŒê²°ìš”ì§€, ì°¸ì¡°ì¡°ë¬¸
    # ê°•í•œ í‚¤ì›Œë“œ ë§¤ì¹­ â†’ ì¦‰ì‹œ True
    # ì¼ë°˜ í‚¤ì›Œë“œ â‰¥ threshold â†’ True
```

**ì—°ê´€ì„± ì—†ëŠ” ë°ì´í„° ìë™ ì œì™¸**:
- âœ… êµí†µì‚¬ê³  ê´€ë ¨: "ìŒì£¼ìš´ì „", "ì‹ í˜¸ìœ„ë°˜" â†’ í¬í•¨
- âŒ ë¬´ê´€í•œ ë°ì´í„°: "íš¡ë ¹", "ì‚¬ê¸°" â†’ ìë™ ì œì™¸
- âš ï¸ ì• ë§¤í•œ ê²½ìš°: thresholdë¡œ ì¡°ì • ê°€ëŠ¥

#### **1.3 íŒë¡€ + í•´ì„ë¡€ ë™ì‹œ ìˆ˜ì§‘**
```python
# íŒë¡€ (prec) + í•´ì„ë¡€ (expc) ëª¨ë‘ ìˆ˜ì§‘
precedents = crawl_cases(TRAFFIC_KEYWORDS, target="prec")
interpretations = crawl_cases(TRAFFIC_KEYWORDS, target="expc")
```

#### **1.4 ì¤‘ë³µ ì œê±° ë° ì—ëŸ¬ ì²˜ë¦¬**
```python
seen_ids: Set[str] = set()  # ì¤‘ë³µ íŒë¡€ ì œê±°

# íƒ€ì„ì•„ì›ƒ, RequestException, JSONDecodeError ì²˜ë¦¬
# ë¡œê¹… ì‹œìŠ¤í…œ í†µí•©
```

---

## ğŸ“‹ 2. ë°ì´í„° í˜•ì‹ ë¹„êµ

### **2.1 í¬ë¡¤ë§ ë°ì´í„° í˜•ì‹ (ë²•ì œì²˜ OpenAPI)**
```json
{
  "ìˆ˜ì§‘ì •ë³´": {
    "ìˆ˜ì§‘ì‹œê°": "2023-11-03T12:00:00",
    "í‚¤ì›Œë“œìˆ˜": 40,
    "íŒë¡€ìˆ˜": 1523,
    "í•´ì„ë¡€ìˆ˜": 342,
    "ì´ê±´ìˆ˜": 1865
  },
  "íŒë¡€": [
    {
      "ê²€ìƒ‰ì–´": "êµí†µì‚¬ê³ ",
      "ë°ì´í„°íƒ€ì…": "íŒë¡€",
      "ì‚¬ê±´ë²ˆí˜¸": "2023ë„1234",
      "ì„ ê³ ì¼ì": "2023-05-15",
      "ë²•ì›ëª…": "ëŒ€ë²•ì›",
      "íŒë¡€ì¼ë ¨ë²ˆí˜¸": "202305151234",
      "ì‚¬ê±´ì¢…ë¥˜ëª…": "ì—…ë¬´ìƒê³¼ì‹¤ì¹˜ì‚¬",
      "íŒê²°ìœ í˜•": "íŒŒê¸°í™˜ì†¡",
      "ë°ì´í„°ì¶œì²˜ëª…": "ëŒ€ë²•ì›ì¢…í•©ë²•ë¥ ì •ë³´",
      "ìƒì„¸ì •ë³´": {
        "íŒë¡€ë‚´ìš©": {
          "íŒì‹œì‚¬í•­": "ìŒì£¼ìš´ì „ ì¤‘ êµí†µì‚¬ê³ ...",
          "íŒê²°ìš”ì§€": "ë„ë¡œêµí†µë²• ì œ148ì¡° ìœ„ë°˜...",
          "ì°¸ì¡°ì¡°ë¬¸": "ë„ë¡œêµí†µë²• ì œ148ì¡°...",
          "ì „ë¬¸": "í”¼ê³ ì¸ì€ 2023ë…„..."
        }
      }
    }
  ],
  "í•´ì„ë¡€": [...]
}
```

### **2.2 ì‹œìŠ¤í…œ DB í˜•ì‹ (PostgreSQL ëª¨ë¸)**

#### **A. `documents` í…Œì´ë¸”**
```python
{
  "id": "uuid-1234",
  "filename": "precedent_202305151234.json",
  "file_hash": "sha256...",
  "document_type": "precedent",  # precedent/interpretation
  "storage_type": "public",      # íŒë¡€ëŠ” ê³µê°œ ë°ì´í„°
  "is_public": True,
  "storage_path": "public-docs/precedents/202305151234.json",
  "is_encrypted": False,
  "ocr_status": "completed",     # í¬ë¡¤ë§ ë°ì´í„°ëŠ” ì´ë¯¸ í…ìŠ¤íŠ¸
  "ocr_confidence": 100.0,       # ë²•ì œì²˜ ê³µì‹ ë°ì´í„°
  "page_count": 1,
  "title": "2023ë„1234",
  "tags": ["êµí†µì‚¬ê³ ", "íŒë¡€", "ëŒ€ë²•ì›"]
}
```

#### **B. `document_structured_data` í…Œì´ë¸” (CSV í˜•ì‹)**
```python
[
  {
    "source_id": "202305151234",      # íŒë¡€ì¼ë ¨ë²ˆí˜¸
    "section_type": "íŒì‹œì‚¬í•­",
    "sentence_number": 1,
    "content": "ìŒì£¼ìš´ì „ ì¤‘ êµí†µì‚¬ê³ ..."
  },
  {
    "source_id": "202305151234",
    "section_type": "íŒê²°ìš”ì§€",
    "sentence_number": 2,
    "content": "ë„ë¡œêµí†µë²• ì œ148ì¡° ìœ„ë°˜..."
  },
  {
    "source_id": "202305151234",
    "section_type": "ì°¸ì¡°ì¡°ë¬¸",
    "sentence_number": 3,
    "content": "ë„ë¡œêµí†µë²• ì œ148ì¡°..."
  }
]
```

#### **C. `document_ai_labels` í…Œì´ë¸” (JSON í˜•ì‹, AI í•™ìŠµìš©)**
```python
{
  "case_name": "2023ë„1234",
  "case_number": "2023ë„1234",
  "decision_date": "2023-05-15",
  "court_name": "ëŒ€ë²•ì›",
  "instruction": "ë‹¤ìŒ ì‚¬ê±´ì˜ íŒê²°ìš”ì§€ë¥¼ ì„¤ëª…í•˜ì„¸ìš”.",
  "input_text": "ì‚¬ê±´ë²ˆí˜¸: 2023ë„1234 | ë²•ì›: ëŒ€ë²•ì› | ì°¸ì¡°ì¡°ë¬¸: ë„ë¡œêµí†µë²• ì œ148ì¡°...",
  "output_text": "ë„ë¡œêµí†µë²• ì œ148ì¡° ìœ„ë°˜...",
  "label_type": "QA",
  "generated_by": "CRAWLING",
  "quality_score": 95.0
}
```

---

## ğŸ”„ 3. ë°ì´í„° í˜•ì‹ ì°¨ì´ì  ë° ë³€í™˜ í•„ìš”ì„±

### **3.1 ì°¨ì´ì  ë¶„ì„**

| í•­ëª© | í¬ë¡¤ë§ ë°ì´í„° | ì‹œìŠ¤í…œ DB | ë¹„ê³  |
|------|-------------|-----------|------|
| **êµ¬ì¡°** | Flat JSON (ë‹¨ì¼ íŒŒì¼) | ê´€ê³„í˜• í…Œì´ë¸” (3ê°œ ë¶„ë¦¬) | âš ï¸ ë³€í™˜ í•„ìš” |
| **ì‹ë³„ì** | íŒë¡€ì¼ë ¨ë²ˆí˜¸ (ë¬¸ìì—´) | UUID (í‘œì¤€) | âš ï¸ ë³€í™˜ í•„ìš” |
| **ë©”íƒ€ë°ì´í„°** | ì œí•œì  | í’ë¶€ (file_hash, storage_path ë“±) | âœ… ì¶”ê°€ ìƒì„± |
| **AI í•™ìŠµìš©** | ì—†ìŒ | instruction/input/output ë¶„ë¦¬ | âœ… ìƒˆë¡œ ìƒì„± |
| **êµ¬ì¡°í™”** | ë‹¨ì¼ JSON | CSV í˜•ì‹ (í–‰ ë‹¨ìœ„ ë¶„ë¦¬) | âš ï¸ ë³€í™˜ í•„ìš” |
| **ì•”í˜¸í™”** | ë¶ˆí•„ìš” (ê³µê°œ ë°ì´í„°) | ì„ íƒì  ì§€ì› | âœ… ê³µê°œ ì„¤ì • |
| **OCR ì •ë³´** | ì—†ìŒ | OCR ìƒíƒœ/ì‹ ë¢°ë„ ì¶”ì  | âœ… ì™„ë£Œë¡œ ì„¤ì • |

### **3.2 ë³€í™˜ í•„ìš” ì—¬ë¶€: âœ… ì˜ˆ, ë³€í™˜ í•„ìš”**

**ì´ìœ **:
1. **ê´€ê³„í˜• DB ìµœì í™”**: ê²€ìƒ‰, í•„í„°ë§, ì¡°ì¸ ì„±ëŠ¥ í–¥ìƒ
2. **AI í•™ìŠµ ë°ì´í„° ìƒì„±**: instruction/input/output í˜•ì‹ í•„ìš”
3. **ì¼ê´€ëœ ë°ì´í„° ëª¨ë¸**: OCR ë¬¸ì„œì™€ ë™ì¼í•œ êµ¬ì¡° ìœ ì§€
4. **í™•ì¥ì„±**: í–¥í›„ ë‹¤ë¥¸ ë°ì´í„° ì†ŒìŠ¤ í†µí•© ìš©ì´

---

## ğŸ’¡ 4. ê¶Œì¥ í†µí•© ë°©ì•ˆ

### **4.1 ë°ì´í„° íë¦„**

```mermaid
ë²•ì œì²˜ OpenAPI
  â†“ [í¬ë¡¤ë§]
í¬ë¡¤ë§ JSON íŒŒì¼ (ì›ë³¸ ë³´ê´€)
  â†“ [ë³€í™˜ ìŠ¤í¬ë¦½íŠ¸]
PostgreSQL DB (3ê°œ í…Œì´ë¸”)
  â†“ [API ì œê³µ]
ì‚¬ìš©ì/AI í•™ìŠµ
```

### **4.2 êµ¬í˜„ ë‹¨ê³„**

#### **Step 1: í¬ë¡¤ë§ ì‹¤í–‰**
```bash
python scripts/crawl_legal_cases.py

# ê²°ê³¼: traffic_legal_data_20231103_120000.json
# - íŒë¡€: 1,523ê±´
# - í•´ì„ë¡€: 342ê±´
# - ì´: 1,865ê±´
```

#### **Step 2: ë°ì´í„° ë³€í™˜**
```bash
python scripts/convert_crawled_data.py traffic_legal_data_20231103_120000.json

# ê²°ê³¼: converted_db_format_20231103_120500.json
# - documents: 1,865ê±´
# - structured_data: 5,595í–‰ (í‰ê·  3í–‰/ê±´)
# - ai_labels: 1,865ê±´
```

#### **Step 3: DB ì €ì¥ (êµ¬í˜„ í•„ìš”)**
```python
# scripts/import_to_db.py
from app.models.document import Document, DocumentStructuredData, DocumentAILabel
from app.core.database import SessionLocal

async def import_converted_data(json_file):
    """ë³€í™˜ëœ JSON â†’ PostgreSQL ì €ì¥"""
    with open(json_file) as f:
        data = json.load(f)

    async with SessionLocal() as session:
        # documents ì €ì¥
        for doc in data["documents"]:
            db_doc = Document(**doc)
            session.add(db_doc)

        # structured_data ì €ì¥
        for row in data["structured_data"]:
            db_row = DocumentStructuredData(**row)
            session.add(db_row)

        # ai_labels ì €ì¥
        for label in data["ai_labels"]:
            db_label = DocumentAILabel(**label)
            session.add(db_label)

        await session.commit()
```

#### **Step 4: ì£¼ê¸°ì  ì—…ë°ì´íŠ¸ (Cron/Celery)**
```python
# ë§¤ì£¼ ì›”ìš”ì¼ ì˜¤ì „ 2ì‹œ ì‹¤í–‰
@celery.task
def weekly_crawl_update():
    # 1. í¬ë¡¤ë§
    crawl_cases(TRAFFIC_KEYWORDS)

    # 2. ë³€í™˜
    convert_crawled_file(latest_file)

    # 3. ì¤‘ë³µ ì²´í¬ í›„ DB ì €ì¥
    import_new_cases_only(converted_file)

    # 4. í†µê³„ ì—…ë°ì´íŠ¸
    update_statistics()
```

---

## ğŸ“ 5. íŒŒì¼ êµ¬ì¡°

```
scripts/
â”œâ”€â”€ crawl_legal_cases.py          # í¬ë¡¤ë§ (ê°œì„  ë²„ì „)
â”œâ”€â”€ convert_crawled_data.py        # ë°ì´í„° ë³€í™˜
â”œâ”€â”€ import_to_db.py                # DB ì €ì¥ (êµ¬í˜„ í•„ìš”)
â””â”€â”€ schedule_crawling.py           # ì£¼ê¸°ì  ì—…ë°ì´íŠ¸ (êµ¬í˜„ í•„ìš”)

data/
â”œâ”€â”€ crawled/                       # í¬ë¡¤ë§ ì›ë³¸ (ë°±ì—…)
â”‚   â””â”€â”€ traffic_legal_data_YYYYMMDD_HHMMSS.json
â”œâ”€â”€ converted/                     # ë³€í™˜ëœ ë°ì´í„°
â”‚   â””â”€â”€ converted_db_format_YYYYMMDD_HHMMSS.json
â””â”€â”€ imported/                      # ì €ì¥ ì™„ë£Œ (ì´ë™)
    â””â”€â”€ imported_YYYYMMDD_HHMMSS.json
```

---

## âœ… 6. ê²°ë¡  ë° ê¶Œì¥ì‚¬í•­

### **ê¶Œì¥ ì‚¬í•­**
1. âœ… **í‚¤ì›Œë“œ í™•ì¥**: 40ê°œ í‚¤ì›Œë“œ ì‚¬ìš© (ê¸°ì¡´ 2ê°œ â†’ 40ê°œ)
2. âœ… **ì—°ê´€ì„± í•„í„°ë§**: `is_traffic_related()` í•¨ìˆ˜ë¡œ ìë™ í•„í„°ë§
3. âœ… **ë°ì´í„° ë³€í™˜**: í¬ë¡¤ë§ â†’ DB í˜•ì‹ ë³€í™˜ ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš©
4. âœ… **ì›ë³¸ ë³´ê´€**: í¬ë¡¤ë§ JSONì€ ë³„ë„ ë³´ê´€ (ê²€ì¦/ë°±ì—…ìš©)
5. âœ… **ì£¼ê¸°ì  ì—…ë°ì´íŠ¸**: ë§¤ì£¼ ë˜ëŠ” ë§¤ì›” ìë™ í¬ë¡¤ë§
6. âœ… **ì¤‘ë³µ ì²´í¬**: íŒë¡€ì¼ë ¨ë²ˆí˜¸ ê¸°ì¤€ ì¤‘ë³µ ì œê±°

### **ë°ì´í„° í˜•ì‹ í†µí•© í•„ìš”ì„±: ë†’ìŒ**
- PostgreSQL ê´€ê³„í˜• êµ¬ì¡° â†’ ê²€ìƒ‰/í•„í„°ë§ ì„±ëŠ¥ í–¥ìƒ
- AI í•™ìŠµìš© ë°ì´í„° ìƒì„± â†’ RAG ì‹œìŠ¤í…œ ìµœì í™”
- ì¼ê´€ëœ ë°ì´í„° ëª¨ë¸ â†’ ìœ ì§€ë³´ìˆ˜ ìš©ì´

### **ë‹¤ìŒ ë‹¨ê³„**
1. âœ… `scripts/crawl_legal_cases.py` - ì™„ë£Œ
2. âœ… `scripts/convert_crawled_data.py` - ì™„ë£Œ
3. â³ `scripts/import_to_db.py` - êµ¬í˜„ í•„ìš”
4. â³ `scripts/schedule_crawling.py` - êµ¬í˜„ í•„ìš”
5. â³ API ì—”ë“œí¬ì¸íŠ¸ì— í¬ë¡¤ë§ ë°ì´í„° í†µí•©

---

## ğŸ“Š 7. ì˜ˆìƒ ë°ì´í„° ê·œëª¨

| í•­ëª© | ì¶”ì •ì¹˜ |
|------|--------|
| êµí†µ ê´€ë ¨ íŒë¡€ | **~3,000ê±´** |
| êµí†µ ê´€ë ¨ í•´ì„ë¡€ | **~500ê±´** |
| ì´ ë°ì´í„° | **~3,500ê±´** |
| DB í¬ê¸° (PostgreSQL) | **~150MB** |
| ì›”ê°„ ì‹ ê·œ ë°ì´í„° | **~50-100ê±´** |

**ì—…ë°ì´íŠ¸ ì£¼ê¸° ê¶Œì¥**: ë§¤ì£¼ ë˜ëŠ” 2ì£¼ë§ˆë‹¤
